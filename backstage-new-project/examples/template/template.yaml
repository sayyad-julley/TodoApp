apiVersion: scaffolder.backstage.io/v1beta3
# https://backstage.io/docs/features/software-catalog/descriptor-format#kind-template
kind: Template
metadata:
  name: new-project-template
  title: New Project Template
  description: |
    A modern project template created using the latest Backstage.io best practices.
    
    This template includes:
    âœ… Modern project structure
    âœ… TypeScript support
    âœ… Best practices configuration
    âœ… TechDocs integration
    âœ… Software catalog registration
  tags:
    - template
    - scaffold
    - typescript
    - modern
  annotations:
    backstage.io/techdocs-ref: dir:.
spec:
  owner: user:guest
  type: service

  parameters:
    - title: Project Information
      required:
        - name
        - owner
      properties:
        name:
          title: Project Name
          type: string
          description: Unique name of the project (use lowercase letters and numbers only)
          pattern: '^[a-z0-9-]+$'
          ui:autofocus: true
          ui:placeholder: my-new-project
        description:
          title: Description
          type: string
          description: Optional description for your project
          default: A new project created with Backstage
          ui:options:
            rows: 3
        owner:
          title: Project Owner
          type: string
          description: Owner of the project
          ui:field: OwnerPicker
          default: user:guest

    - title: Repository Configuration
      required:
        - repoUrl
      properties:
        repoUrl:
          title: Repository Location
          type: string
          description: Git repository URL where the project will be created
          ui:field: RepoUrlPicker
          ui:options:
            allowedHosts:
              - github.com
              - gitlab.com
              - bitbucket.org
        defaultBranch:
          title: Default Branch
          type: string
          description: Default branch name for the repository
          default: main

  steps:
    - id: fetch-base
      name: ğŸ“¥ Fetch Project Template
      action: fetch:template
      input:
        url: ./content
        values:
          name: ${{ parameters.name }}
          description: ${{ parameters.description }}
          owner: ${{ parameters.owner }}

    - id: generate-readme
      name: ğŸ“š Generate Documentation
      action: fetch:plain
      input:
        url: ./content/README.md
        targetPath: README.md

    - id: generate-catalog-info
      name: ğŸ“‹ Generate Catalog Info
      action: fetch:template
      input:
        url: ./content/catalog-info.yaml
        targetPath: catalog-info.yaml
        values:
          name: ${{ parameters.name }}
          description: ${{ parameters.description }}
          owner: ${{ parameters.owner }}

    - id: publish
      name: ğŸš€ Publish to Repository
      action: publish:github
      input:
        description: |
          ğŸ‰ **New Project Created Successfully!**
          
          **Project:** ${{ parameters.name }}
          **Description:** ${{ parameters.description }}
          
          Created with â¤ï¸ using Backstage
        repoUrl: ${{ parameters.repoUrl }}
        defaultBranch: ${{ parameters.defaultBranch }}

    - id: register
      name: ğŸ“‹ Register in Catalog
      action: catalog:register
      input:
        repoContentsUrl: ${{ steps['publish'].output.repoContentsUrl }}
        catalogInfoPath: '/catalog-info.yaml'

  output:
    links:
      - title: ğŸ“‚ Repository
        url: ${{ steps['publish'].output.remoteUrl }}
        icon: github
      - title: ğŸ“‹ Open in Catalog
        icon: catalog
        entityRef: ${{ steps['register'].output.entityRef }}
